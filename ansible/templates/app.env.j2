# FILE: ansible/templates/app.env.j2
# =================================================================
# APPLICATION ENVIRONMENT CONFIGURATION
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# =================================================================

# Database Configuration
DB_HOST={{ db_host }}
DB_PORT={{ db_port }}
DB_NAME={{ db_name }}
DB_USERNAME={{ db_username }}
DB_PASSWORD={{ db_password }}
DATABASE_URL=postgresql://{{ db_username }}:{{ db_password }}@{{ db_host }}:{{ db_port }}/{{ db_name }}
DB_SSL=require
DB_POOL_MIN=2
DB_POOL_MAX=10
DB_TIMEOUT=30000

# S3 Configuration
S3_BUCKET={{ s3_bucket }}
AWS_REGION={{ aws_region }}
AWS_DEFAULT_REGION={{ aws_region }}
S3_UPLOAD_PATH=uploads
S3_PUBLIC_PATH=public
S3_BACKUP_PATH=backups

# Application Configuration
NODE_ENV={{ node_env | default('production') }}
PORT={{ app_port }}
HOST=0.0.0.0
APP_NAME={{ app_name }}
APP_VERSION=1.0.0
ENVIRONMENT={{ environment }}

# Logging Configuration
LOG_LEVEL={{ log_level | default('info') }}
LOG_DIR={{ log_directory }}
LOG_MAX_SIZE=100MB
LOG_MAX_FILES=10
ENABLE_REQUEST_LOGGING=true

# Security Configuration
JWT_SECRET={{ vault_jwt_secret | default('change-me-in-production-' + ansible_date_time.epoch) }}
JWT_EXPIRES_IN=24h
BCRYPT_ROUNDS=12
SESSION_SECRET={{ vault_session_secret | default('change-me-in-production-' + ansible_date_time.epoch) }}
COOKIE_SECURE={{ enable_ssl | default(false) }}

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_FAILED_REQUESTS=false

# Feature Flags
ENABLE_MONITORING={{ enable_monitoring | default(true) }}
ENABLE_METRICS=true
ENABLE_HEALTH_CHECK=true
ENABLE_CACHING=true
ENABLE_RATE_LIMITING=true
ENABLE_COMPRESSION=true

# External Services
REDIS_URL={{ redis_url | default('redis://localhost:6379') }}
ELASTICSEARCH_URL={{ elasticsearch_url | default('') }}

# Email Configuration (if applicable)
SMTP_HOST={{ smtp_host | default('') }}
SMTP_PORT={{ smtp_port | default('587') }}
SMTP_USER={{ smtp_user | default('') }}
SMTP_PASS={{ smtp_pass | default('') }}
EMAIL_FROM={{ email_from | default('noreply@example.com') }}

# File Upload Configuration
MAX_FILE_SIZE={{ max_upload_size | default('10mb') }}
ALLOWED_FILE_TYPES=jpg,jpeg,png,pdf,doc,docx,txt,csv
UPLOAD_TEMP_DIR=/tmp/uploads

# Monitoring Configuration
METRICS_PORT={{ metrics_port | default('9090') }}
HEALTH_CHECK_TIMEOUT=5000
ENABLE_APM={{ enable_apm | default(false) }}

# Performance Configuration
CLUSTER_WORKERS={{ ansible_processor_vcpus | default(1) }}
KEEP_ALIVE_TIMEOUT=65000
HEADERS_TIMEOUT=66000

# Development/Debug (disabled in production)
DEBUG={{ 'true' if environment == 'dev' else 'false' }}
ENABLE_CORS={{ 'true' if environment != 'prod' else 'false' }}
TRUST_PROXY=true